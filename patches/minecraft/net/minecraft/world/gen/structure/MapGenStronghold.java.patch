--- before/net/minecraft/world/gen/structure/MapGenStronghold.java
+++ after/net/minecraft/world/gen/structure/MapGenStronghold.java
@@ -1,9 +1,11 @@
 package net.minecraft.world.gen.structure;
 
 import com.google.common.collect.Lists;
+import it.unimi.dsi.fastutil.objects.ObjectIterator;
 import java.util.List;
 import java.util.Map;
 import java.util.Random;
+import java.util.Map.Entry;
 import net.minecraft.util.math.BlockPos;
 import net.minecraft.util.math.ChunkPos;
 import net.minecraft.util.math.MathHelper;
@@ -14,17 +16,28 @@
 {
     public final List<Biome> field_151546_e;
     private boolean field_75056_f;
-    private ChunkPos[] field_75057_g = new ChunkPos[128];
-    private double field_82671_h = 32.0D;
-    private int field_82672_i = 3;
+    private ChunkPos[] field_75057_g;
+    private double field_82671_h;
+    private int field_82672_i;
 
     public MapGenStronghold()
     {
-        this.field_151546_e = Lists.newArrayList();
+        this.field_75057_g = new ChunkPos[128];
+        this.field_82671_h = 32.0D;
+        this.field_82672_i = 3;
+        this.field_151546_e = Lists.<Biome>newArrayList();
 
         for (Biome biome : Biome.field_185377_q)
         {
-            if (biome != null && biome.func_185355_j() > 0.0F)
+            if (biome != null && biome.func_185355_j() > 0.0F && !net.minecraftforge.common.BiomeManager.strongHoldBiomesBlackList.contains(biome))
+            {
+                this.field_151546_e.add(biome);
+            }
+        }
+
+        for (Biome biome : net.minecraftforge.common.BiomeManager.strongHoldBiomes)
+        {
+            if (!this.field_151546_e.contains(biome))
             {
                 this.field_151546_e.add(biome);
             }
@@ -35,17 +48,17 @@
     {
         this();
 
-        for (Map.Entry<String, String> entry : p_i2068_1_.entrySet())
+        for (Entry<String, String> entry : p_i2068_1_.entrySet())
         {
-            if (entry.getKey().equals("distance"))
+            if (((String)entry.getKey()).equals("distance"))
             {
                 this.field_82671_h = MathHelper.func_82713_a(entry.getValue(), this.field_82671_h, 1.0D);
             }
-            else if (entry.getKey().equals("count"))
+            else if (((String)entry.getKey()).equals("count"))
             {
                 this.field_75057_g = new ChunkPos[MathHelper.func_82714_a(entry.getValue(), this.field_75057_g.length, 1)];
             }
-            else if (entry.getKey().equals("spread"))
+            else if (((String)entry.getKey()).equals("spread"))
             {
                 this.field_82672_i = MathHelper.func_82714_a(entry.getValue(), this.field_82672_i, 1);
             }
@@ -112,9 +125,12 @@
     {
         this.func_143027_a(this.field_75039_c);
         int i = 0;
+        ObjectIterator lvt_2_1_ = this.field_75053_d.values().iterator();
 
-        for (StructureStart structurestart : this.field_75053_d.values())
+        while (lvt_2_1_.hasNext())
         {
+            StructureStart structurestart = (StructureStart)lvt_2_1_.next();
+
             if (i < this.field_75057_g.length)
             {
                 this.field_75057_g[i++] = new ChunkPos(structurestart.func_143019_e(), structurestart.func_143018_f());
@@ -169,6 +185,7 @@
 
         for (mapgenstronghold$start = new MapGenStronghold.Start(this.field_75039_c, this.field_75038_b, p_75049_1_, p_75049_2_); mapgenstronghold$start.func_186161_c().isEmpty() || ((StructureStrongholdPieces.Stairs2)mapgenstronghold$start.func_186161_c().get(0)).field_75025_b == null; mapgenstronghold$start = new MapGenStronghold.Start(this.field_75039_c, this.field_75038_b, p_75049_1_, p_75049_2_))
         {
+            ;
         }
 
         return mapgenstronghold$start;
