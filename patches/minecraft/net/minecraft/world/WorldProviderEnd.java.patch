--- before/net/minecraft/world/WorldProviderEnd.java
+++ after/net/minecraft/world/WorldProviderEnd.java
@@ -20,7 +20,7 @@
     public void func_76572_b()
     {
         this.field_76578_c = new BiomeProviderSingle(Biomes.field_76779_k);
-        NBTTagCompound nbttagcompound = this.field_76579_a.func_72912_H().func_186347_a(DimensionType.THE_END);
+        NBTTagCompound nbttagcompound = this.field_76579_a.func_72912_H().getDimensionData(this.field_76579_a.field_73011_w.getDimension());
         this.field_186064_g = this.field_76579_a instanceof WorldServer ? new DragonFightManager((WorldServer)this.field_76579_a, nbttagcompound.func_74775_l("DragonFight")) : null;
     }
 
@@ -50,9 +50,9 @@
         float f1 = 0.627451F;
         float f2 = 0.5019608F;
         float f3 = 0.627451F;
-        f1 *= f * 0.0F + 0.15F;
-        f2 *= f * 0.0F + 0.15F;
-        f3 *= f * 0.0F + 0.15F;
+        f1 = f1 * (f * 0.0F + 0.15F);
+        f2 = f2 * (f * 0.0F + 0.15F);
+        f3 = f3 * (f * 0.0F + 0.15F);
         return new Vec3d((double)f1, (double)f2, (double)f3);
     }
 
@@ -113,7 +113,7 @@
             nbttagcompound.func_74782_a("DragonFight", this.field_186064_g.func_186088_a());
         }
 
-        this.field_76579_a.func_72912_H().func_186345_a(DimensionType.THE_END, nbttagcompound);
+        this.field_76579_a.func_72912_H().setDimensionData(this.field_76579_a.field_73011_w.getDimension(), nbttagcompound);
     }
 
     public void func_186059_r()
@@ -128,5 +128,23 @@
     public DragonFightManager func_186063_s()
     {
         return this.field_186064_g;
+    }
+
+    @Override
+    public void func_186061_a(net.minecraft.entity.player.EntityPlayerMP player)
+    {
+        if (this.field_186064_g != null)
+        {
+            this.field_186064_g.addPlayer(player);
+        }
+    }
+
+    @Override
+    public void func_186062_b(net.minecraft.entity.player.EntityPlayerMP player)
+    {
+        if (this.field_186064_g != null)
+        {
+            this.field_186064_g.removePlayer(player);
+        }
     }
 }
